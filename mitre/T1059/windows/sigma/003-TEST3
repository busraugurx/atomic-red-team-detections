title: PowerShell Spawning Obfuscated CMD via Environment Variable Expansion
id: 55b8ea01-9da6-4b8c-91ee-97de14a55df0
status: experimental
description: >
  Detects PowerShell launching cmd.exe with environment variable expansion
  and chained command execution using /c. This technique is commonly used
  to obfuscate command execution, evade simple command-line detections,
  and is frequently observed in living-off-the-land and fileless attack
  scenarios related to MITRE ATT&CK T1059.003.
references:
  - https://attack.mitre.org/techniques/T1059/003/
  - https://github.com/redcanaryco/atomic-red-team
author: Busra Ugur
date: 2026/01/28
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    Image|endswith: '\cmd.exe'
    ParentImage|endswith: '\powershell.exe'
    CommandLine|contains|all:
      - '/c'
      - '%LOCALAPPDATA'
  condition: selection
falsepositives:
  - Legitimate administrative scripts using environment variables
  - Automation or deployment tooling invoking cmd.exe via PowerShell
  - Red team simulations or atomic testing
level: medium
tags:
  - attack.execution
  - attack.t1059.003
  - attack.defense_evasion
